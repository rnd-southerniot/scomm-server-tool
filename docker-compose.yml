version: "3.9"

name: scomm-server-tool

networks:
  scomm:
    driver: bridge

volumes:
  pg_data:
  redis_data:
  grafana_data:

services:
  # --- Data plane ---
  mqtt:
    extends:
      file: data-plane/mqtt/docker-compose.yml
      service: mqtt
    networks: [scomm]

  # --- Control plane ---
  postgres:
    extends:
      file: control-plane/chirpstack/docker-compose.yml
      service: postgres
    networks: [scomm]

  redis:
    extends:
      file: control-plane/chirpstack/docker-compose.yml
      service: redis
    networks: [scomm]

  chirpstack:
    extends:
      file: control-plane/chirpstack/docker-compose.yml
      service: chirpstack
    depends_on: [postgres, redis, mqtt]
    networks: [scomm]

  gateway_bridge:
    extends:
      file: control-plane/chirpstack/docker-compose.yml
      service: gateway_bridge
    depends_on: [mqtt]
    networks: [scomm]

  # --- Observability ---
  prometheus:
    extends:
      file: observability/prometheus/docker-compose.yml
      service: prometheus
    networks: [scomm]

  alertmanager:
    extends:
      file: observability/alertmanager/docker-compose.yml
      service: alertmanager
    networks: [scomm]

  grafana:
    extends:
      file: observability/grafana/docker-compose.yml
      service: grafana
    depends_on: [prometheus]
    networks: [scomm]
